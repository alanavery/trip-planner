<section class="sec-trip-info">
  <h2><%= trip.name %></h2>
  <div class="div-trip-info">
    <p><%= trip.startDate %> to <%= trip.endDate %></p>
    <p class="trip-edit">Edit</p>
    <p class="trip-delete">Delete</p>
  </div>
</section>

<section class="sec-trip-edit" hidden>
  <form action="/trips/<%= trip.id %>/?_method=put" method="post">
    <label for="trip-name">Name</label>
    <input id="trip-name" type="text" name="name" value="<%= trip.name %>">

    <label for="trip-start-date">Start Date</label>
    <input id="trip-start-date" type="date" name="startDate" value="<%= trip.startDate %>">

    <label for="trip-end-date">End Date</label>
    <input id="trip-end-date" type="date" name="endDate" value="<%= trip.endDate %>">

    <input type="submit" value="Update">
  </form>
</section>

<section class="sec-trip-delete" hidden>
  <p>Are you sure you want to delete this trip?</p>
  <form action="/trips/<%= trip.id %>/?_method=delete" method="post">
    <input type="submit" value="Delete">
  </form>
</section>

<section class="add-segment" hidden>
  <form action="/trips/<%= trip.id %>" method="post">
    <label for="add-segment-subcategory">Category</label>
    <select name="subcategoryId" id="add-segment-subcategory" required>
      <option value="">Choose a category</option>
      <% subcategories.forEach(subcategory => { %>
      <option value="<%= subcategory.id %>"><%= subcategory.name %></option>
      <% }); %>
    </select>
    <label for="add-segment-search">Search</label>
    <input id="add-segment-search" type="text" name="search">
    <label for="add-segment-name">Name</label>
    <input id="add-segment-name" type="text" name="name" required>
    <label for="add-segment-notes">Notes</label>
    <textarea id="add-segment-notes" name="notes"></textarea>
    <label for="add-segment-address">Address</label>
    <input id="add-segment-address" type="text" name="address">
    <label for="add-segment-phone">Phone</label>
    <input id="add-segment-phone" type="tel" name="phone">
    <label for="add-segment-url">Website</label>
    <input id="add-segment-url" type="url" name="url">
    <p>Booked?</p>
    <label for="add-segment-booked-yes">Yes</label>
    <input id="add-segment-booked-yes" type="radio" name="booked" value="true">
    <label for="add-segment-booked-no">No</label>
    <input id="add-segment-booked-no" type="radio" name="booked" value="false" checked>
    <input id="add-segment-date" type="hidden" name="date" value="">
    <input type="submit" value="Submit">
  </form>
</section>

<section class="sec-schedule">

  <% let startDate = new Date(trip.startDate); %>
  <% let endDate = new Date(trip.endDate); %>
  <% let numDays = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1; %>
  <% let weekdays = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday']; %>

  <!-- Render each day -->
  <% for (let i = 0; i < numDays; i++) { %>

  <% let date = new Date(); %>
  <% date.setDate(startDate.getUTCDate() + i); %>
  <% let dateFormatted = `${date.getFullYear()}-${date.getMonth() + 1}-${date.getDate()}`; %>

  <div id="day-<%= dateFormatted %>" class="div-day">

    <div class="div-day-header">
      <h3><%= weekdays[date.getDay()] %></h3>
      <button class="add-segment-button">+</button>
      <form action="/trips/<%= trip.id %>/<%= dateFormatted %>/?_method=put" method="post">
        <input class="edit-day-order" type="hidden" name="order" value="">
        <input type="submit" value="Save">
      </form>
    </div>

    <div class="div-day-main">

      <% segments.forEach(segment => { %>
      <% if (`${segment.date.getUTCFullYear()}-${segment.date.getUTCMonth() + 1}-${segment.date.getUTCDate()}` === dateFormatted) { %>

      <div class="div-segment">
        <div class="div-segment-box">

          <div class="segment-info">
            <div class="segment-info-primary">
              <p class="segment-id" hidden><%= segment.id %></p>
              <h5><%= subcategories[segment.subcategoryId - 1].name %></h5>
              <h4><%= segment.name %></h4>
              <p><%= segment.notes %></p>
            </div>
            <div class="div-segment-info-secondary" hidden>
              <% if (segment.address) { %>
              <p>Address: <%= segment.address %></p>
              <% } %>
              <% if (segment.phone) { %>
              <p>Phone: <%= segment.phone %></p>
              <% } %>
              <% if (segment.url) { %>
              <p>Website: <a href="<%= segment.url %>"><%= segment.url %></a></p>
              <% } %>
              <% if (segment.booked) { %>
              <p>Booked: <%= segment.booked %></p>
              <% } %>
              <button class="segment-edit">Edit</button>
              <form class="segment-delete"
                action="/trips/<%= trip.id %>/<%= dateFormatted %>/<%= segment.id %>/?_method=delete" method="post">
                <input type="submit" value="Delete">
              </form>
            </div>
          </div>

          <form class="form-segment-edit"
            action="/trips/<%= trip.id %>/<%= dateFormatted %>/<%= segment.id %>/?_method=put" method="post" hidden>
            <label for="segment-subcategory">Category</label>
            <select name="subcategoryId" id="segment-subcategory" required>
              <option value="">Choose a category</option>
              <% subcategories.forEach(subcategory => { %>
              <% if (subcategory.id === segment.subcategoryId) { %>
              <option value="<%= subcategory.id %>" selected><%= subcategory.name %></option>
              <% } else { %>
              <option value="<%= subcategory.id %>"><%= subcategory.name %></option>
              <% } %>
              <% }); %>
            </select>
            <input type="hidden" name="date" value="<%= dateFormatted %>">
            <label for="segment-name">Name</label>
            <input id="segment-name" type="text" name="name" value="<%= segment.name %>" required>
            <label for="segment-address">Address</label>
            <input id="segment-address" type="text" name="address" value="<%= segment.address %>">
            <label for="segment-phone">Phone</label>
            <input id="segment-phone" type="tel" name="phone" value="<%= segment.phone %>">
            <label for="segment-url">Website</label>
            <input id="segment-url" type="url" name="url" value="<%= segment.url %>">
            <label for="segment-notes">Notes</label>
            <textarea id="segment-notes" name="notes"><%= segment.notes %></textarea>
            <p>Booked?</p>
            <% if (segment.booked) { %>
            <label for="segment-booked-yes">Yes</label>
            <input id="segment-booked-yes" type="radio" name="booked" value="true" checked>
            <label for="segment-booked-no">No</label>
            <input id="segment-booked-no" type="radio" name="booked" value="false">
            <% } else { %>
            <label for="segment-booked-yes">Yes</label>
            <input id="segment-booked-yes" type="radio" name="booked" value="true">
            <label for="segment-booked-no">No</label>
            <input id="segment-booked-no" type="radio" name="booked" value="false" checked>
            <% } %>
            <input type="submit" value="Update">
            <button class="segment-edit-cancel">Cancel</button>
          </form>

        </div>
      </div>

      <% } %>
      <% }); %>

    </div>

  </div>

  <% } %>

</section>


<!-- Page scripts -->
<script src="/api.js"></script>
<script defer
  src="https://maps.googleapis.com/maps/api/js?key=<%= process.env.GOOGLE_MAPS_API_KEY %>&libraries=places&callback=initAutocomplete"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/gsap.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.5.1/Draggable.js"></script>
<script src="/drag-drop-v02.js"></script>
<script src="/app.js"></script>